\input{figs/backgrounds.tex}
%% Important variables:
% Number of POT
% Number of muons stopped
% Total run time
\chapter{COMET \phaseII: Backgrounds}
\sectlabel{backgrounds}
Having optimised and evaluated the signal sensitivity, it is now important to check the expected background rates.
Interpreting the final result to declaring an observation or produce a confidence limit is only possible if the number of background events has been predicted.
The certainty of any observation or the stringency of a final confidence limit is determined by the relative background rate and signal sensitivity; ideally the background rate should be small, well below a single expected event.

The types of background we must consider for COMET were outlined in \sect{detector:background}, but in this section they are evaluated in the optimised experiment design using the improved simulation.

\FigDIOBackground
\section{Muon Decay in Orbit (\acs{DIO})}
\sectlabel{bg:dio}
%\begin{easylist}
%# Discussed in previous section \sect{sense:momentum}
%# DIO spectrum near end-point: which expansion is correct?
%# Final DIO rate above momentum threshold with resolution
%\end{easylist}
In order to decide the optimal threshold for the momentum cut, it was necessary, in section \sect{sense:momentum}, to study the rate of \ac{DIO} events.
At the selected momentum threshold of \VarMomThreshold, the number of expected DIO events per muon stop is \VarDIOPerMuStop{}.
Given the \VarTotalMuStops~muon stops that should take place during \phaseII, the total expected number of background events due to DIO is \VarDIOTotal.

However, it is important to note just how steeply falling the DIO rate is in this region.
\Fig{bg:dio:rates} shows how, given a fixed signal sensitivity, the number of DIO background events is affected.
Changing the momentum threshold also affects the signal acceptance, so that for a fixed \ac{ses} one must increase the running time.
Simultaneously, with more muons stopped the \ac{DIO} rate will increase for a fixed momentum threshold.
\Fig{bg:dio:rates} was produced using the same DIO and signal spectra shown in \fig{sense:spectra:resolution}, which included energy losses in the material of the target, beamline, and detector, as well as a 200~keV/c Gaussian resolution function. 
In addition, all the acceptance parameters of the sensitivity chapter were held fixed, except for the momentum cut efficiency.

\FigDIOEndPointComparison
The fact that the run-time, signal acceptance, and background rate depend so strongly on the momentum threshold makes the theoretical prediction for the \ac{DIO} spectrum particularly important.
The two most recent calculations of the high-energy tail of the DIO spectrum are shown in \fig{bg:dio:spectra}, as well as the cruder function that fits the whole spectrum range, used in SimG4.
The more conservative spectrum from the 2011 paper has been used in this study.
However, if one were to use the more recent 2015 spectrum, background rates due to DIO would fall to 0.072 events at the same momentum threshold.
This would agree with that papers statement that the inclusion of radiative corrections suppresses the DIO background by 15\% at the end-point.

In total, based on the 2011 DIO spectrum, \sci{14}{-17} electrons would be produced per muon stop with momentum greater than 104~MeV/c.
Therefore, the DIO rejection efficiency, including both geometric effects and the threshold on the detected momentum, suppress the detection of DIO end-point electrons by about 98.4\%.

\section{Radiative Muon Capture (\acs{RMC})}
\TabRMCEndPoints%
\sectlabel{bg:rmc}
During the process of nuclear muon capture, there is a finite probability of a hard photon being radiated from the muon, nucleus, or the exchanged $W$-boson.
This is known as \acf{RMC} and is distinguished from radioactive gamma-ray production during nuclear de-excitation or decay of the daughter nucleus.
The maximum energy this photon can take, $\max(E_e^\textrm{RMC})$, differs from the \mueconv signal and \ac{DIO} end-point by the minimum energy needed to change the nucleus from $N(A,Z)$ to $N(A,Z-1)$:
\begin{align}
\max(E_e^\textrm{RMC})=&\big(M_\mu - B_{\mu,\textrm{binding}} - E_\textrm{rec}\big)-\big(M_{N_2}+\sum_iM_{h_i}-M_{N_1}-\Delta{}Z\cdot{}M_e\big),\\
                      =&E^\textrm{Conversion}_e  - \Delta{}M,
\end{align}
with $M_{N_1}$ and $M_{N_2}$ the mass of the parent and daughter nuclei respectively, and $M_{h_i}$ the mass of the $i$-th hadron (proton, neutron, alpha, \etc).
The mass of the electron, $M_e$, must also be included since for ever proton removed from the nucleus, given by $\Delta{}Z$, a free electron must be ejected from the atomic orbitals.
$\Delta{}M$ is then the total energy lost to changes in the atomic mass%
\footnote{
One has to think of the atomic mass difference, rather than the nuclear mass difference.
The distinction is important since consideration of the nuclear masses alone would ignore the effect on the atomic electrons.
Under nuclear muon capture (radiative or otherwise), the number of protons in the nucleus is reduced by at least one, and accordingly atomic electrons become unbound.
The notation here follows that of the COMET TDR~\cite{TDR2016} and CDR~\cite{CDRphase2}, where the electron mass is absorbed into the value of $\Delta{}M$ (although there it is called $\Delta_{Z-1}$).
}
of the nuclei and other emitted hadrons.

When an aluminium-27 nucleus captures a muon various daughter nuclei are possible.
If no other particles are emitted, as part of a prompt process or direct nucleon capture, the daughter nucleus will be magnesium-27.
In general, this could be left in an excited state, but to reach the end-point of the \ac{RMC} spectrum it will be left in the ground-state configuration.
The atomic mass difference between these two nuclei is shown in \tab{bg:rmc:massDifferences}, where it can be seen the RMC end-point is separated from the \mueconv signal energy by around 3~MeV.

\FigRMCExperiments
%\newcolumntype{d}[1]{D{.}{\cdot}{#1} }

\Fig{bg:rmc:experiments} shows the summary table of experimental data on Aluminium, taken from the summary by Gorringe~\cite{RevModPhys.76.31}.
It is interesting to note that in all experiments to date none of the emprical fits to RMC used have suggested an end-point above 90.1~MeV~\cite{PhysRevC.37.1633,PhysRevC.46.1094,PhysRevC.59.2853}.
This is close to the end-point predicted by the various transitions besides ${}^{27}$Al$(\mu,\gamma\nu){}^{27}$Mg.
The most recent of these two experiments both measure the branching ratio for \ac{RMC} producing photons with $E>57~$MeV to ordinary muon capture to be \sci{1.43}{-5}. 

To produce a background event in the detector, the high-energy photons produced from RMC must be produce to a high-energy electron.
Asymmetric pair production from this photon is one such process, although producing the positron at rest is highly suppressed.
In addition, around 1~MeV is consumed my the mass of the electron-positron pair.
Compton scattering provides another mechanism by which the high-energy photon can convert to a high-energy electron.
In the limit where the photon is reflected directly back, the resultant electron is around $M_e/2$ more energy than the incoming photon.
As such it is Compton scattering which is more of a concern for COMET.

Finally, given the maximum photon energy is below the momentum threshold of \VarMomThreshold, the energy needs to be mis-reconstructed by around 2.4~MeV.
If the final resolution function were Gaussian with a 200~keV/c width (at signal energies), then mis-reconstruction by such an amount would be an 11~$\sigma$ event, \ie $P(p_\textrm{recon}-p_\textrm{true}>\SI{2.4}{MeV/c})=\num{1.9e-28}$.
However, the resolution function is not likely to be a pure Gaussian.
On-going studies for reconstruction with the  \phaseI StrECAL currently suggest that $P(p_\textrm{recon}-p_\textrm{true}>\SI{2.4}{MeV/c})=\num{7.5e-3}$~\cite{YFujiiStrECALRecon}.
Although this is considerably larger than the pure Gaussian, this is based on the most preliminary results of reconstruction algorithms.
If need be, cuts on fit quality can be improved over the current \phaseI values; the sensitivity estimate presented here should be robust against this since it includes the CDR estimate for the signal efficiency of such a cut.

\subsection{Calculation and Simulation of RMC}
Conversion of the RMC photons can take place in any of the material around the target, such as the beam blocker, solenoids, or cryostat.
To estimate the acceptance of the electrons produced from this conversion a simulation was performed where RMC photons were input at the stopping target, using the realistic muon stopping distribution obtained previously.
Geant4 implements the process of photo conversion via both of the above methods.

To build a realistic end-point spectrum, the same recipe as used in the \phaseI TDR was applied~\cite{TDR2016}.
The spectrum shape near the end-point is modelled by the equation~\cite{CHRISTILLIN1980331}:
\begin{equation}
	\eqlabel{bg:rmc:spect}
	\Gamma(\textrm{RMC})\propto(1-2x+2x^2)(x)(1-x)^2,
\end{equation}
where $x=E_\gamma/\max(E_e^\textrm{RMC})$.
The largest observed branching ratio for \ac{RMC}---\num{1.83e-5} compared to ordinary muon capture---is used to set the normalisation.
The relative rate of \ac{RMC} resulting in photons with energies above 90~MeV is, based on the spectrum in equation~\eq{bg:rmc:spect}, \num{7.7e-3} of the experimentally observed rate.
\FigRMCSimResults

Given the total number of muon stops during \phaseII, the probability of ordinary muon capture, and the relative rates for \ac{RMC}, one expects some \num{1.2e11} photons to be produced in the target with energies above 95~MeV.
Since this is an intrinsic background, the lifetime of this process will be the same as for signal events. 
Assuming, therefore, the same timing window acceptance, and applying the same reconstruction and TDAQ efficiencies as for signal, this number is reduced to \num{3.3e10}.
If the resolution function were truly a 200~keV/c Gaussian, then this would be no issue, regardless of the geometric acceptance or probability of Compton scattering.
If, however, the current \phaseI high-energy reconstruction tail were present, we would expect some \num{2.4e8} events to be considered dangerous if they were all accepted.

To check the geometric acceptance of the beamline, some \num{6e7} RMC events were generated in the stopping target, with initial photon energies greater than 90~MeV and distributed according to the spectrum in equation~\eq{bg:rmc:spect}.
\Fig{bg:rmc:simulation} shows the momentum and rate at which these were detected.
Based on this, the fraction of events reaching the detector with momentum larger than 98~MeV/c was \num{6.2e-7}, whilst above 100~MeV/c only \num{3.3e-8} electrons per \ac{RMC}$|_{p>90}$ event were detected.

As a result, if the current \phaseI resolution were applied, we would expect around 8 background events during the entire run.
However, since the resolution function at this stage is so poorly known, it seems to premature to define a value.
Instead, the predicted RMC rate provides a constraint on the high-energy tail of the resolution function: to do better than 0.1 background events during \phaseII from RMC, fewer than 1 in \num{1e4} high-energy electrons can be reconstructed with a momentum more than 2.4~MeV/c larger than the true value.

\subsection{Aluminium-26 and \acs{RMC}}
Based on the above energy calculation, the end-point for \ac{RMC} against ${}^{26}$Al (to ${}^{26}$Mg with no other particles emitted) would be 108.5~MeV.
Clearly such photons would be extremely dangerous to COMET if they are produced.

Aluminium-26 comes in two isomers, one with a half-life of around 6 seconds~\cite{PhysRevLett.106.032501}, the other lasting around 700 thousand years~\cite{AUDI20033}.
Since Al-26 is unstable its abundance in natural aluminium is low.
However, it can be produced by various methods, such as proton and deuteron bombardment of magnesium and sodium, or photoneutron emission of the aluminium-27 isotope~\cite{THOMPSON1965486}.
With such production mechanisms, it is likely that alumininium-26 will be produced in the COMET stopping target, via the interaction of daughter nuclei of muon capture (which are typically magnesium and sodium)
with protons, deuterons, gammas, and neutrons coming from either the beam or as products of muon capture.
The exact rate of Al-26 production, however, is a complicated value to estimate and one that unfortunately cannot be estimated here.

One can, however, set an acceptable rate of production if the induced background event rate is to be kept at the level of 0.1 events.
Based on the previous simulation of Al-27 \ac{RMC}, the probability of an electron being detected within 5~MeV of the \ac{RMC} end-point is \num{5.6e-18} per nuclear muon capture.
With \VarTotalMuStops muon stops during \phaseII, and assuming that the branching ratios for both ordinary and radiative muon capture are the same for Al-26 and Al-27 (61\%), then the
concentration of Al-26 in the stopping target must be less than 1\% (by number density) on average during the entire \phaseII run.
The branching ratio for radiative muon capture is, in reality, likely to be slightly more than in Al-27, based on the fact that the neutron excess of a given isotope seems a better indicator of the branching ratio than atomic number, and that the two are anti-correlated~\cite{RevModPhys.76.31}.

Clearly though, there is more work to be done on this, including a better understanding of \ac{RMC} events coming from Al-26, as well as understanding the rate of Al-26 production from muon beams.
Data from the \alcap experiment might be able to help with this, however, since the production rate could depend a lot on the exact beam conditions, measuring this directly should be an important goal of \phaseI.

Finally, if this does produce a sizeable background contribution, one can imagine several techniques to mitigate or reduce the challenge this poses.
Provided one can measure the concentration of Al-26 in the stopping target at the end of the run, and ideally at various stages whilst running, then the number of backgrounds can be predicted and possibly subtracted.
Additionally, it could be possible to remove the stopping target and replace it with a fresh one such that the Al-26 concentration never rises beyond an unsafe level.

\CHECK{Mention that this could be a useful source of calibration}

\section{Radiative Pion Capture (\acs{RPC})}
\sectlabel{bg:rpc}
When low-energy negative pions are stopped in material they behave similarly to negative muons and form pionic atoms.
The probability that the pion is then captured by the nucleus rather than decays in orbit is, however, considerably larger than for a muon.
Furthermore, given the extra 30~MeV/c$^2$ of the pion mass and the lack of an outgoing neutrino, the end-point for \acf{RPC} by the nucleus is well above the \mueconv signal energy.
As for photons of \ac{RMC}, the \ac{RPC} photons can then be converted via Compton scattering or pair production to signal-like electrons.
Pion capture could, therefore, be a dangerous source of backgrounds and was likely the dominant source of background events at \sindrumII.

Since the pion interacts via the strong force, negative pions capture almost immediately in the nucleus, on the order of picoseconds~\cite{Engelhardt:1975ct}.
The timing of backgrounds caused from pion capture are therefore determined predominantly by the time when the pion was produced.
If a background arises from pion capture and the pion was produced in the main muon pulse, then the pion or resultant background electron must have been significantly delayed.
Delayed \ac{RPC} backgrounds are therefore suppressed by the time-gated detector window.
If however a background arises because the pion was produced outside of the main proton pulse, due to late-arriving protons (or from antiprotons, but we will treat these separately below), then this background is considered prompt.
These prompt \ac{RPC} background events are, therefore, suppressed by the extinction factor.

The background rate per \ac{POT} for prompt and delayed pions is therefore:
\begin{align}
	R_\textrm{prompt}=&R_{\pi/p}\mathcal{B}_\textrm{RMC}f_{e,\textrm{RMC}}A_\textrm{time}, \\
	R_\textrm{prompt}=&R_{\pi/p}\mathcal{B}_\textrm{RMC}f_{e,\textrm{RMC}}\epsilon_\textrm{extinction},
\end{align}
where $R_{\pi/p}$ is the pion stopping rate per \ac{POT} and $\mathcal{B}_\textrm{RMC}$ is the branching ratio of \ac{RMC} for stopped pions.
$\epsilon_\textrm{extinction}$ is the extinction factor, whereas $A_\textrm{time}$ is the acceptance of the time-gated detector window to RMC electrons.
$f_{e,\textrm{RMC}}$ is the probability that an RMC photon converts to an electron which reaches the detector with signal-like momentum.
To a reasonable approximation, this can be factorised as:
\begin{equation}
f_{e,\textrm{RMC}}=f_{\gamma\rightarrow{}e^-}A_\textrm{geom}A_\textrm{mom}
\end{equation}
where $f_{\gamma\rightarrow{}e^-}$ is the conversion rate of RMC photons to an electron, $A_\textrm{geom}$ and $A_\textrm{mom}$
are, respectively, the geometric acceptance and momentum cut efficiency for such electrons.
However, such a factorisation misses out various correlations, such as where in the experiment the conversion takes place and at what momentum the secondary electron is produced, so that only a single value for $f_{e,\textrm{RMC}}$ will be reported here.

\FigRPCData
\subsection{Photons from Radiative Pion Capture (\acs{RPC})}
%In much the same way as \ac{RMC}, when a pion is captured in a nucleus there is a chance that it will produce a prompt, hard photon.
There is a range of experimental and theoretical data on \ac{RPC}. 
\Fig{bg:rpc:spectrum} shows what is perhaps the most useful data currently available: the observed spectrum of photons coming from RPC for magnesium and calcium.
Magnesium being adjacent to aluminium on the periodic table, this spectrum is a reasonable proxy for the spectrum of \ac{RPC} on aluminium.
The relative rate for \ac{RPC} compared to ordinary pion capture is discussed in Amaro \etal~\cite{Amaro:1997ed}.
For experimental and theoretical studies of the three isotopes summarised in that paper---carbon, oxygen, and calcium---the measured and predicted branching ratios are all within 1.19\% and 2.27\%.
To be conservative, we take here the branching ratio for RPC on aluminium to be the largest of these as 2.27\%.

\subsection{Pion Stopping Rate}
\FigPionStopDist
\FigPiVsMuMomenta
To simulate the pion stopping rate, the pions from the main production simulation were resample multiple times to build up a large number of pion stops.
\Fig{bg:piStop:dist} shows the distribution of pions stopping in the target, in one-dimensional projections to the ICEDUST global coordinate system.
In that coordinate system, pions arrive from large values of Z at the target, so the pion beam in \fig{bg:piStop:dist:z} is going from right to left.
By comparison with the plots in \fig{sense:stops}, pions tend to stop further downstream in the target.
This is readily understood by the fact that pions reaching the stopping target tend to have much higher momentum than muons reaching the target, as shown in \fig{bg:piVsMu:momenta}.

In total, the number of pions stopping in the target per \ac{POT} is $R_{\pi/p}=$\VarPiStopsPerPOT.

\subsection{Simulating \acs{RPC}}
\FigRPCSimulatedSpectrum
\FigRPCSimResults
Using the realistic pion stopping distribution shown in \fig{bg:piStop:dist}, \ac{RPC} photons were generated in the target and Geant4 used to convert and track electrons resulting from this process.
To model the distribution of photon energies from \ac{RPC}, the experimentally obtained spectrum from magnesium of ref.~\cite{Bistirlich:1972jy} was used.
To build the model, the raw spectrum was first digitised and then smoothed, using `TGraphSmooth::SuperSmooth()' from the  ROOT library~\cite{ROOT}.
These steps are shown in \fig{bg:rpc:spectrum}.

Based on a simulation of \num{4e6} RPC photons, the distribution of electrons and positrons reaching the detector was obtained.
The timing and momentum of such electrons is shown in \fig{bg:rpc:sim}, where it is clear that although many signal-like electrons are detected, they all arrive well before the gated-time threshold of 600~ns.

The probability of an \ac{RPC} photon producing an electron that reaches the detector with momentum between \VarMomThreshold and 105~MeV/c is: $f_{e,\textrm{RMC}}=$\VarDetectedEsPerRPC.
To estimate the rate of delayed \ac{RPC} backgrounds, we also need to know the value of $A_\textrm{time}$.
As can be seen in \fig{bg:rpc:sim:momVtime}, the timing for electrons originating from RPC photons and detected with momentum greater than 30~MeV/c is independent of the momentum.
By fitting the tail of this distribution with a single exponential, the lifetime of the high-energy electrons is found to be \VarRPCLifetime, such that with the timing window between 600 and 1200~ns we find the acceptance of the timing window to be: $A_\textrm{time}=\VarRPCTimingEfficiency$.

\Tab{bg:rpc:estimates} summarizes these numbers, from which we find that the rate of backgrounds for delayed \ac{RPC} is \VarRPCDelayedPerPOT per POT, whilst the prompt form occurs at \VarRPCPromptPerPOT.
\begin{table}[tb]
\centering
        \begin{tabular}{llm{0.5\textwidth}}
	\hline
        Parameter & \multicolumn{1}{l}{Value} & Description \\
	\hline
        $R_{\pi/p}$                    & \VarPiStopsPerPOT & Pion stopping rate per \ac{POT}  \\ 
        $\mathcal{B}_\textrm{RPC}$     & \num{2.27e-2} & Branching ratio of \ac{RPC} \\ 
	$f_{e,\textrm{RPC}}$           & \VarDetectedEsPerRPC & Probability of an RPC photon producing signal-like electrons in the detector \\ 
	$A_\textrm{time}$              & \VarRPCTimingEfficiency & Acceptance of timing window to secondary electrons from RPC \\ 
        $\epsilon_\textrm{extinction}$ & \VarExtinctionFactor[2] &  Extinction factor\\ 
	\hline
\end{tabular}
\caption{\tablabel{bg:rpc:estimates}
Parameters and their values in the determination of the \ac{RPC} background rate.
}
\end{table}

\section{Antiprotons in the Beam}
\sectlabel{bg:antiprotons}
Antiprotons can be produced when the primary 8~GeV proton beam interacts with the production target, creating a proton--antiproton pair:
\begin{equation}
p + N(A,Z) \rightarrow p + N^*(A,Z) + p+\bar{p}
\end{equation}
Given their relatively large mass, antiprotons travel much more slowly than other products of the same momentum, causing the beam's time structure to be smeared for antiprotons and their secondaries.
The pulsed beam and time-gated detector window are, therefore, not effective at suppressing backgrounds created by antiprotons in the beam.

%Secondaries of antiproton interactions with matter include X-rays and pions, though pion production dominates~\cite{BobBernsteinExperimentersGuide,Mishustin:2004xa}.
%
The interaction of antiprotons with matter has a strong analogy with muons and negative pions, particularly at low energies, when the antiprotons stop.
%There is a strong analogy between antiproton stopping in matter and the phenomona around negative muon and pion stopping.
In matter, antiprotons with energies of a few tens of keV---similar to that of atomic electrons---can become bound in the Coulomb potential of the atom's nucleus.
X-rays emitted in the ensuing electromagnetic cascade are typically not more than a 100~keV~\cite{Aramaki201352}.
Unlike for muons, the antiproton will only rarely reach the atomic ground state, with interactions with the nucleus becoming dominant before this is possible.
Such interactions can take the form of an immediate annihilation or the formation of a composite nucleus where the antiproton becomes bound within the nuclear potential~\cite{Wong:1984fy,Mishustin:2004xa}.
The binding energy of some of these nuclear levels can reach up to hundreds of MeV, and so in the transition, pions and other hadrons can be readily produced.
Eventually though the antiproton will annihilate in the nucleus, producing large multiplicities of pions and other mesons.

As such, although antiprotons themselves are not an immediate source of high-energy photons or electrons, they are an additional source of pions, which can produce backgrounds via \acf{RPC}.

\subsection{Antiproton Production Rate and Spectrum}
The literature on antiproton production with 8~GeV protons on a tungsten target and at large angles is somewhat lacking.
%There is really very little literature on the production of antiprotons from a tungsten target for a range of angles.
Accordingly most hadron models are particularly under-constrained when it comes to antiproton production.
The QGSP_BERT_HP model used as the basis for SimG4 is, in fact, completely unable to produce antiprotons.

\FigAntiprotonMeco
In the COMET TDR~\cite{TDR2016}, the yield of antiprotons per \ac{POT} is given as \num{4e-5}, based on the findings of a literature review and simulations undertaken for the MECO experiment~\cite{Meco024}.
The dependence of the antiproton production cross section on incident proton momentum based on that study is shown in \fig{bg:antiprotons:meco24}.

Simulations of antiprotons for \phaseI have used this information and shown that absorber foils would be needed along the beamline.  
Since the \phaseII geometry in ICEDUST re-uses most of the implementation for the Production Target Capture and Torus1 sections, the upstream absorbers are also contained in the geometry used to study antiprotons here,
although the absorber near 90\degree has been removed.

\FigAntiprotonData
Whilst tungsten targets have not been studied at the relevant angles and proton energies, a set of papers \cite{Boyarinov:1994tp,Kiselev:2012sj} do exist covering antiproton production up to 2 radians for tantulum (which is adjacent to tungsten on the periodic table), copper, aluminium, and beryllium targets and using protons with 10.14~GeV kinetic energy.
Between them, these two papers provide the invariant triple-differential cross section as a function of antiproton momentum for production angles of 10, 59, 97 and 119\degree, defined as:
\begin{equation}
\eqlabel{bg:antiprotons:lit}
	F(p,\theta,\phi)=E \frac{d^3\sigma}{dp^3}=E\frac{d^3\sigma(p,\theta,\phi)}{p^2dpd\Omega}
\end{equation}
where $E$ and $p$ are the antiproton energy and momentum.  The earlier Boyarinov paper actually reports $f=F/A$, where $A$ is the relative atomic mass of the nucleus.
To convert the differential invariant cross sections given in the literature (equation~\eq{bg:antiprotons:lit}) into a differential production rate per \ac{POT}, $d^3R(\theta)/dpd\Omega$, the following formula is used:
\begin{align}
	\eqlabel{bg:antiprotons:rate}
	\frac{d^3R(p,\theta,\phi)}{dp^3}&=\frac{F(p,\theta,\phi)}{E}\frac{\rho N_A l}{m_N}
\end{align}
where $\rho$ is the mass density of the target, 19.25~g/cm$^3$ for Tungsten, $m_N$ the atomic mass, 183.86~g/mol for tungsten, $l$ the length of the target, and $N_A$ is Avodadro's number.
\Fig{bg:antiprotons:data} shows the data from these papers, after scaling the cross sections for each material to the number of nucleons in tungsten.
The data has also been converted to a differential rate of production, given the \phaseII production target dimensions, using equation~\eq{bg:antiprotons:rate}.
From this data, it is clear that as one moves to larger angles, the spectrum becomes considerably softer whilst the overall rate falls quickly, in much the same way as for pion production.

\subsection{Modelling Antiproton Production}
To develop the data in the Boyarinov~\etal papers into a model for antiproton production, three dependencies must be considered:
the incident proton's momentum, the outgoing antiproton's momentum, and the outgoing antiproton's direction with respect to the incident proton.

To account for these dependencies, the cross section was factorised according to the equation:
\begin{align}
\eqlabel{bg:antiprotons:factorisation}
	\frac{d^3R(p,\theta,\phi)}{dp^3}=&\xi{}P(p,\theta_\mathrm{min})\Phi(\theta,\phi),
\end{align}
where $\xi$ is a scale factor to correct for the different incoming proton energy, $P(p,\theta_\textrm{min})$ models the momentum distribution at a given angle and is normalised to unity, and $\Phi(\theta,\phi)$ encapsulates the dependence on the antiproton's direction.

\subsubsection*{Dependence on the Incident Proton's Momentum: $\xi$}
The data in the Boyarinov papers was taken using protons with kinetic energies of 10.14~GeV.
The threshold for antiproton production against a single, free nucleon is 5.6~GeV; the cross-section increases rapidly above this energy, as indicated in \fig{bg:antiprotons:meco24}.
Because of this, COMET has chosen to use an 8~GeV (kinetic energy) beam, and accordingly it is important to scale the antiproton cross sections from the Boyarinov~\etal papers to account for this.

\Fig{bg:antiprotons:meco24} suggests that the cross section at 8~GeV is about one order of magnitude smaller than at 10.14~GeV, although the data and models included in that plot are for a lead target as opposed to tungsten.

In a paper by Danielewicz~\cite{PhysRevC.42.1564}, a theoretical calculation is performed to estimate the rate of antiproton production.
Equation (4.3) of that paper gives the antiproton production cross section for nucleon-proton interactions as:
\begin{equation}
\sigma_{NN}^{\bar{p}}=C(\sqrt{s}-4m)^{7/2}
\end{equation}
where $\sqrt{s}$ is the Mandelstam variable for the total invariant incoming energy, and $m$ the mass of a nucleon.
$C$ depends on properties of the nucleus and is fixed in that paper using experimental data.
Based on this equation, the cross section for antiproton production at 8~GeV should be a factor of 0.12 times that at 10.14~GeV.
Since this agrees well with \Fig{bg:antiprotons:meco24}, we take $\xi=0.12$.

\subsubsection*{Dependence on the Outgoing Antiproton's Momentum: $P(p,\theta_\textrm{min})$}
The momentum spectrum of antiprotons at a given angle is captured in the factor $P(p,\theta_\textrm{min})$.
We base the shape of this spectrum on the data from the Boyarinov papers.

\FigAntiprotonEndpoint
In order to complete the data and cover the full range of energies at which antiprotons might be produced, we add two additional points to the experimental data for the maximum and minimum momentum.
Including the minimum momentum only adds the constraint that at zero momentum the cross section also be zero.
On the other hand, to calculate the maximum momentum, the kinematic end-point was found by considering the entire nucleus and the two outgoing protons to recoil coherently against the antiproton.
The value of the end-point kinetic energy and longitudinal and transverse momenta for both tungsten and carbon are shown in \fig{bg:antiprotons:end-point} using the formulae derived in appendix~\sect{appendix:antiprotonEndpoint}.
This end-point will be a highly conservative estimate, since in reality not all the nucleus will recoil coherently;  the de Broglie wavelength for a proton with 8~GeV kinetic energy is about 0.15~fm, compared to the 7~fm or so of a tungsten nucleus%
\footnote{Antiproton production from protons in this energy regime was historically referred to as `sub-threshold production', since it is below the threshold for single nucleon interactions, around 5.6~GeV.
The fact antiprotons are observed is therefore proof that it is not a single, stationary nucleon that interacts with the proton and the nuclear environment as a whole must be considered.
  The older literature on this topic in fact refers to a parameter called the `cumulative number' which was related to the number of nucleons that must be involved to produce secondary hadrons (\eg antiprotons or pions) with such outgoing energies, given the incoming proton energy.  
These sub-threshold secondary particles were themselves sometimes called cumulative particles.}.
Additionally, achieving this end-point configuration would be highly phase-space suppressed.

\FigAntiprotonFits
With the addition of these two end-points, to interpolate and extrapolate the data, a polynomial of order 4 to 6 (depending on the number of available data points) was used to fit from zero up to the last experimental datum.
For the high-momentum tails of each spectrum, three fits were tried: a straight line fit between the last experimental datum and the kinematic end-point described above; an exponential fitted to the kinematic end-point and the last two experimental data points; and an average of both of these fits.
\Fig{bg:antiprotons:fits} shows the results of this fitting procedure, where it can be seen that a low-momentum peak is visible and a high-momentum tail well described.
Whilst these spectra are likely a poor representation of the true production spectrum, they serve as useful upper bounds which can be used as inputs for the antiproton background rate estimation.

The momentum distribution will, of course, depend on the angle of production relative to the proton beam.
With only four production angles available in the experimental data, however, for a given angle, $\theta$, we assign the momentum distribution based on the data at the next smallest production angle, $\theta_\textrm{min}$.
Since the spectrum becomes softer at larger values of $\theta$, this will tend to further overestimate the high-energy tail of the momentum distribution.
In the case of angles smaller than 10\degree, given the lack of other data, we fix the  shape of the momentum distribution to be the same as that at 10\degree.

The function $P(p,\theta_\textrm{min})$ is the piecewise function that is fit to the data and kinematic end-points and then normalised so that the integral is one.
The overall normalisation is instead absorbed into the angular dependence factor.

\subsubsection*{Dependence on the Outgoing Antiproton's Direction: $\Phi(\theta,\phi)$}
\TabAntiprotonRegions
\FigAntiprotonAngularDependence
$\Phi(\theta,\phi)$ accounts for the variation of the cross section as the angle between the incoming proton and outgoing antiproton changes.
Clearly, by symmetry, there should be no dependence on $\phi$.

To estimate the cross section at a given angle, the fitted distributions described in the last section were integrated.
The results of these integrations is given in \tab{bg:antiprotons:regions} and shown graphically in \fig{bg:antiprotons:angular}.
%When these distributions are used to generate particles they are essentially normalised so their integral is unity.
%For a given value of $\theta$ the momentum distribution $dP/dp$ is chosen to match the first spectrum measured at a larger value of $\theta$.
%This keeps the model conservative since the true momentum spectrum should soften as one moves to higher angles which this will not do.
%$d\Phi/d\theta$ is then used to vary the overall normalisation as a function of theta.
Boyarinov \etal state~\cite{Boyarinov:1994tp} that the angular dependence of antiproton production should take the form:
\begin{equation}
%\frac{d\Phi(\theta)}{d\theta}
\Phi(\theta)=\alpha e^{\beta\cos\theta}
\end{equation}
where $\alpha$ and $\beta$ are constants. 

It is for this reason that the axes of \fig{bg:antiprotons:angular} are $\cos\theta$ and $\ln(R)$: if such a function were valid, the points would form a straight line.
In fact it seems the variation in these parameters are better described by a quadratic function, although the fitted quadratic functions all reach a minimum above $\cos\theta=-1$, which seems unphysical.

However, to keep things conservative, rather than use  a linear or quadratic fit to the integrated data, we use the linear interpolation between each adjacent datum to provide the function, $\Phi(\theta,\phi)$.
For the same reason, we use the integrated cross sections obtained for the fits that use a linear function for the high-momentum tail.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
%\FigAntiprotonEndpoint
%To build the limited number of data-points from this paper into a complete but conservative spectrum, empirical fits to the data were performed after adding two data points for the minimum and maximum momentum.
%The minimum momentum only added the constraint that at zero momentum the cross section also be zero.
%On the other hand, to calculate the maximum momentum the kinematic end-point was found by considering the entire nucleus and the two outgoing protons to recoil directly against the antiproton.
%The value of the end-point kinetic energy and longitudinal and transverse momenta for tungsten and carbon are shown in \fig{bg:antiprotons:end-point} using the formulae derived in appendix~\sect{appendix:antiprotonEndpoint}.
%This end-point will be a highly conservative estimate, since in reality not all the nucleus will recoil coherently;  the de Broglie wavelength for a proton with 8~GeV kinetic energy is about 0.15~fm, compared to the 7~fm or so of a tungsten nucleus%
%\footnote{Antiproton production from protons in this energy regime was historically referred to as `sub-threshold production', since it is below the threshold for single nucleon interactions, around 5.6~GeV.
%The fact antiprotons are observed is therefore proof that it is not a single, stationary nucleon that interacts with the proton and the nuclear environment as a whole must be considered.
%  The older literature on this topic in fact refers to a parameter called the `cumulative number' which was related to the number of nucleons that must be involved to produce secondary hadrons (\eg antiprotons or pions) with such outgoing energies, given the incoming proton energy.  
%These sub-threshold secondary particles were themselves sometimes called cumulative particles.}.
%Additionally, achieving this end-point configuration would be highly phase-space suppressed.
%
%\FigAntiprotonFits
%With the addition of these two end-points, to interpolate and extrapolate the data, a polynomial of order 4 to 6 (depending on the number of available data points) was used to fit from zero up to the last experimental datum.
%For the high-momentum tails of each spectrum, two fits were tried: a straight line fit between the last experimental datum and the kinematic end-point described above; and an exponential fitted to the kinematic end-point and the last two experimental data points.  
%\Fig{bg:antiprotons:fits} shows the results of this fitting procedure, where it can be seen that a low-momentum peak is visible and a high-momentum tail well described.
%Whilst these spectra are likely a poor representation of the true production spectrum, they serve as useful upper bounds which can be used as inputs for the antiproton background rate estimation.
%
%\TabAntiprotonRegions
%\subsection{Simulating Antiprotons}
%To study the resultant backgrounds, antiprotons were generated uniformly in the production target.
%Four separate simulations were run, corresponding to the four angular regions provided by the data, as shown in \tab{bg:antiprotons:regions}.
%For each simulation, antiprotons were generated isotropically within a cone parallel to the incoming proton beam, with minimum and maximum values of theta defined by the angular region being studied.
%The momentum distribution for each simulation used the fit to the data for the angle at the lower edge of the region, $\theta_\textrm{min}$ (and for the region from 0 -- 59\degree, the fit to the 10\degree data was used).
%
%\FigAntiprotonAngularDependence
%To account for the strong angular dependence visible from the measurements, each input antiproton event was reweighted during analysis based on the angle between the initial antiproton direction and the proton beam.
%The combined procedure of generating isotropically with a momentum distribution based on the fit to the data, then reweighting based on the angle, amounts to the following factorisation of the measured differential cross section:
%%It is clear from the four measured directions that the cross section for antiproton prodcution has a strong dependence on the angle of production.
%%To extrapolate this dependence to angles other than those measured, the differential cross section was factorised into a momentum and angular dependence:
%\begin{align}
%\eqlabel{bg:antiprotons:factorisation}
%	F(p,\theta,\phi)=&\left(\frac{E}{p^2}\frac{d\rho(p)}{dp}\right)~\left(\frac{1}{2\pi}\frac{d\Theta(\theta)}{d\theta}\right),\\
%	                =&P(p,\theta_\mathrm{min})\Phi(\theta),
%\end{align}
%where $P(p,\theta_\textrm{min})$ is the fitted momentum spectrum for the differential rate at the lower angle of the current region, $\theta_\textrm{min}$.
%$P(p,\theta_\textrm{min})$, therefore, is the probability density function used to generate the momentum for each antiproton in the simulation, and as such the normalisation of $P(p,\theta_\textrm{min})$ is fixed to unity.
%
%Instead, $\Phi(\theta)$ is used to provide the event weight.
%It encapsulates the total probability of an antiproton being produced at the given angle with respect to the incident proton, and is found by integrating the fits shown in \fig{bg:antiprotons:fits}.
%
%The results of these integrations is shown in \fig{bg:antiprotons:angular}.
%%When these distributions are used to generate particles they are essentially normalised so their integral is unity.
%%For a given value of $\theta$ the momentum distribution $dP/dp$ is chosen to match the first spectrum measured at a larger value of $\theta$.
%%This keeps the model conservative since the true momentum spectrum should soften as one moves to higher angles which this will not do.
%%$d\Phi/d\theta$ is then used to vary the overall normalisation as a function of theta.
%Boyarinov \etal state~\cite{Boyarinov:1994tp} that the angular dependence of antiproton production should take the form:
%\begin{equation}
%%\frac{d\Phi(\theta)}{d\theta}
%\Phi(\theta)=\alpha e^{\beta\cos\theta}
%\end{equation}
%where $\alpha$ and $\beta$ are constants. 
%It is for this reason that the axes of \fig{bg:antiprotons:angular} are $\cos\theta$ and $\ln(R)$: if such a function were valid, the points would form a straight line.
%In fact it seems like a quadratic function might be more appropriate, although the fitted quadratic functions all reach a minimum above $\cos\theta=-1$.
%To keep things conservative then, instead of a linear or quadratic function fitted to all data points, we use the linear interpolation between each adjacent datum to provide the function, $\Phi(\theta)$.
%Of the three possible fits to the high-momentum tail, the angular dependence obtained by the linear tail is used for the reweighting, again to ensure this simulation be conservative.
%
%Finally, it should be noted that the factorisation in equation \eq{bg:antiprotons:factorisation} injects the assumption that the momentum distribution at a given angle is independent of the angle.
%Whilst this should not be the case for a realistic spectrum, to produce limits on the background rate it is a valid assumption---the spectrum becomes softer with increasing production angle so the spectrum at the smaller angle should be an overestimate.
%In addition, the $\phi$ dependence of $\Phi(\theta,\phi)$ is assumed constant, since the target and proton beam in COMET are not polarised.

\subsection{Simulating Antiproton Backgrounds}
\FigAntiprotonSimFluxes
To study backgrounds from antiprotons, four separate simulations were performed, one for each of the angular region described in \tab{bg:antiprotons:regions}, with \num{8e7} antiprotons fed in to each simulation.
Within each angular region, antiprotons were generated uniformly across the production target, with momenta distributed according to $P(p,\theta_\textrm{min})$.
Given how steeply the angular distribution tails off, in order to check the acceptance of antiprotons produced at large angles, events were generated isotropically within the angular region, and then reweighted during analysis based on $\xi\Phi(\theta,\phi)$, ie. the probability that an antiproton is produced in this direction.

The beamline's acceptance to antiprotons and the secondary pions that they produce are shown in \fig{bg:antiprotons:sim:fluxes}.
The events in this plot are unweighted by the antiproton angle.
From these plots, it is clear that the material at the entrance to the Torus1 solenoid removes a large fraction of the antiprotons---about 99\% of the antiprotons produced between 97 and 119\degree.
It can also be seen that the acceptance in the bent solenoids for antiprotons is about two orders of magnitude greater for antiprotons produced at angles greater than 119\degree, compared to those produced between 97 and 119\degree.

For pion production and acceptance, however, the unweighted rate for the four angular regions is very similar, particularly towards the end of Torus2.
This, and the fact that the transmission probability has a negative gradient for each angular region along the whole beamline, implies that the main source for pions is the interaction of antiprotons in the primary target.
Pions produced by antiprotons hitting collimators or the beampipe will quickly be removed since they will tend to stay close to this material.
If pions were produced at the foil at the entrance to the Torus1 then they would be in the centre of the beampipe and have a greater chance of being transported, although this does not seem to be a major source.

\FigAntiprotonSimHeightsTwoDPbar
\FigAntiprotonSimHeightsTwoDPiMin
\TabAntiprotonResultsAntip
\TabAntiprotonResultsPiSecond
\afterpage{\clearpage}

\Fig{bg:antiprotons:sim:2D-antip} shows the trajectories of antiprotons along the beamline, where each trajectory has been weighted according to the antiproton's production direction with respect to the proton beam axis.
Similarly, \fig{bg:antiprotons:sim:2D-pi} shows the same information but for pions instead.
The colour scale and range in each of these four plots is the same between all plots.  
One can see, then, that although the acceptance per antiproton is considerably larger for larger angle production (119--180\degree), the production rate is so small that the final probability of observing an antiproton is quite low.
As such, it is the antiprotons produced in the forwards direction and scattered backwards by the production target that will dominate the antiproton background rate.

\Tab{bg:antiprotons:sim:antip} and \tab{bg:antiprotons:sim:pi} show the number of antiprotons and pions that enter the Torus1 (`Torus1 Entrance'), reached the final collimator (`Before Torus2 Coll.'), and arrived at the target (`Before Target').
Also shown is the sum over all events with each event weighted by the initial antiproton direction and proton energy scale correction ($\xi\cdot\Phi(\theta,\phi)$), and normalised to the number of antiprotons introduced into the simulation.
Since no antiprotons are seen stopping in the target for the angular region from 0 to 59\degree, to estimate the stopping rate for antiprotons produced in this direction, 
the probability that antiprotons would reach the stopping target is made by finding the median acceptance of the collimator (which occurs for the region from 59\degree to 97\degree) and multiplying the observed weighted sum for antiprotons just before the collimator.
The timing distributions for antiprotons and pions is shown in \fig{bg:antiprotons:sim:time}, from where it is clear that timing information from the pulsed proton beam is not meaningful for antiprotons.
However, since the majority of secondary pions that are successfully transported to the target originate in the production target, the pulsed beam timing is a strong way to suppress the backgrounds these can produce via \ac{RPC}.
In fact, given that these pions originate in the production target, the background rate due to RPC of pions directly produced by the proton beam can be reused, including the timing cut.
For antiprotons, the rate of RPC backgrounds per pion stop is also used, however the mean number of negative pions produced per antiproton stop is included, as well as the overall efficiency of the timing window, assuming a flat timing distribution.
%All of these factors are summarised in \tab{bg:antiprotons:factors}.
For both pions and antiprotons, the efficiency of the TDAQ and reconstruction are also included, with the same values as for signal.
Based on these factors, the numbers in \tab{bg:antiprotons:sim:antip} and \tab{bg:antiprotons:sim:pi} can be converted to background estimates, which are shown in \tab{bg:antiprotons:estimates}.
\FigAntiprotonSimTime
\TabAntiprotonEstimates

The total predicted antiproton rate per \ac{POT} is therefore \VarBgAntiprotonsPerPOT, which is completely dominated by antiprotons produced in the forward direction but scatter within the production target and are successfully transported to the stopping target.
This number is considerably larger than would be desirable for the COMET experiment.
It is important, therefore, to remember that this is an especially conservative estimate:
\begin{itemize}
\item The kinematic end-point is a large overestimate for the true end-point of the spectrum since the incoming proton will never interact with the entire nucleus.  
\item The straight-line-fit to the tail, that was used to generate antiprotons in the simulation will produce higher momentum antiprotons than are likely to occur, which changes the penetration depth in material.
      In addition, the straight-line-fit increases the integrated yield of antiprotons significantly, which impacts on the event-by-event weight.
      For example, for the region from  59--97\degree, there are up to two orders of magnitude difference on the predicted antiproton yield depending on the high-energy description.
      \CHECKmargin{Add to the first table the integrals with the other tail descriptions.}
\item Antiproton events were generated with a uniform distribution in the production target. Given that the proton beam profile will be close to a double Gaussian, with most of the probability concentrated in the centre of the target, there will typically be more material for the antiprotons to pass through as they leave the target.  This will increase the rate of absorption and thus reduce the antiproton rate further.
\item The data this model is based on uses 10~GeV initial protons. The antiproton yield is expected to grow rapidly at these sorts of energies.
      According to the model in~\cite{Meco024}, the cross section at 8~GeV is at least an order of magnitude lower than for incident protons with 10~GeV.
\item The final value assumes that all the negative pions produced from stopping antiprotons are captured by nuclei in the target.  In reality, many of these will escape from the target and decay in flight or be stopped and captured elsewhere.  The pion multiplicity factor used here is likely an overestimate, therefore.
\end{itemize}
At the same time, the fact that these results are somewhat statistically limited, given the small number of antiproton stops seen from the forward going antiprotons, one can expect a sizeable uncertainty on this value.
In addition, some of the other factors that have been included, such as from the RPC background estimation, also increase the uncertainty since there might be other correlations that such factorisation cannot include.

On the other hand, the fact that it is scattering from forward produced antiprotons has some advantage, since there is experimental data in the forward region---admittedly with materials other than tungsten or with proton energies other than 8~GeV---that could be used to develop further understanding of this background.

\subsection{Reducing Antiproton Backgrounds Further}
%\begin{easylist}
%# Ways to improve this / further optimisations:
%## Antiprotons close to the beam axis after the production target: on-axis blocker (activation?)
%## Absorber material in lower half of TS3
%# Thicker absorber at the muon beamline entrance
%# Need to check the muon beam intensity
%\end{easylist}
Given that the antiproton with the current beamline design appears larger than desirable, it will be necessary to take steps to reduce it.
There are several options that can be pursued, but each must be checked for its impact on the muon beam intensity.
Firstly, one can simply increase the thickness of the foil at the entrance to the Torus1.
In a similar way, one can introduce additional foils along the beamline, such as at the TS3 solenoid in between the Torus1 and Torus2.
The downside of both of these methods is that they will be in the path of the muon beam, and since the $dE/dx$ curve for negative muons below 100~MeV has a negative slope, this material will likely increase the mean muon momentum (but of course decrease the overall intensity).

If material is added, then it would be beneficial if this material were low-Z.  This would maximize the ratio of the rate of antiproton loss to the muon loss rate.
In fact, a bug in the geometry during initial simulations of antiprotons left air at the exit to the production section.  
The impact on the muon and pion was found to be trivial, but the antiproton acceptance into the Torus1 was zero at the limit of the sample size of the simulations.

Finally, if a volume in the beamline close to the production target were identified, where the separation between antiprotons that stop and muons that stop, then this should also be exploited.
However, in the studies performed here, such a region does not seem apparent.
Additionally, material close to the production target would need to be considered from an activation and safety perspective, in addition to the impact on the muon and pion beam.

\section{Direct Beam-Related Backgrounds}
\sectlabel{bg:beam}
%\begin{easylist}
%	# Number of POT simulated
%	# Number of observed high-momentum electrons or muons
%	# Lifetime of muons at the target (need to smear this a bit ?): Fit the projection of high-momentum particles to the time with an exponential and extrapolate
%	# Survival probability per high-momentum particle before the target to reach the straw tracker
%\end{easylist}
Although neither a muon or pion in their rest frame can decay to electrons greater than 55~MeV, if these particles are boosted sufficiently the resulting electron can be produced with signal-like momentum.
For muons at 78~MeV/c Michel electrons can occur at 105~MeV/c if produced in the direction of the muon's momentum.
For pions, the threshold for signal-like electrons to be produced during decay is 58~MeV/c, although the branching fraction for this process is helicity suppressed to around \num{1e-4}.

The bent solenoids and the pulsed beam help to suppress these sorts of backgrounds, whilst the beam blocker, downstream of the target disks, reduces the geometric acceptance.
The inner radius of the collimator at the exit of Torus2 is set to 12~cm, whilst the beam blocker has a radius of 25~cm. 
As the beam passes along the stopping target region, the beam envelope grows due to the reduction in the solenoidal field strength.
The radius of the beam blocker, however, is large enough that even with this growth there should be no direct line of sight between the muon beam and the spectrometer.
As such, the only way for beam particles to reach the detector are by a hard scatter off the target or beam blocker, or to be produced via decay of another particle close to the target itself.

To check the probability that signal-like electrons are produced in the beam and arrive at the detector in the time window,
the output of the large production target simulation was resampled five times, so that around \num{1.4e9}~\ac{POT} events were studied, equivalent to 7.5~\phaseII bunches \CHECK{Is this the right number of simulated events?}.
\Fig{bg:beam:MomVsTime:strawTrk} shows the momentum and timing of electrons at the straw tracker, from which it is clear that no background events were observed within the gated-time detector window.
One electron is observed at 98~MeV/c, but this occurs around 100~ns after the proton bunch.
This immediately sets a limit on the background rate---less than 1 in \num{1.4e9} per POT.
\FigBgBeamMomVsTime

Clearly then it is necessary to apply some extrapolation to understand this background better.
Indeed, it will never be feasible to directly simulate the $10^{21}$ or so POT that would be necessary to infer the background rate without some extrapolation.
To make this extrapolation, we look at the same distribution immediately after the beam blocker.  
At this point there are far more electrons so it is easier to fit and model the distributions.
\Fig{bg:beam:MomVsTime:stopTgt} shows the momentum vs.\ time plot for electrons immediately after the beam blocker.

The rate of observing delayed, signal-like electrons due to high-energy beam particles is modelled by factorisation of the acceptances:
\begin{align}
R_\mathrm{beam}=&A_\textrm{geom}A_\textrm{mom}A_\textrm{time},\\
=&\left(\frac{N_\textrm{obs}}{N_\textrm{POT}}\right)\left(\frac{\int\limits_{104.2}^{105.5}f(p)dp}{\int\limits_{p_\textrm{low}}^{105.5}f(p)dp}\right)\left(\frac{\int\limits_{600}^{1200}g(t)dt}{\int\limits_{30}^{1200}g(t)dt}\right),
\eqlabel{bg:beam:factors}
\end{align}
where $A_\textrm{geom}$,$A_\textrm{mom}$, and $A_\textrm{time}$ are geometric acceptance and efficiencies of the momentum and timing thresholds, respectively.
$N_\textrm{obs}$ is the number of events actually seen at the straw tracker, whilst $N_\textrm{POT}$ is the number of simulated \acp{POT}.
In the case of prompt beam electrons, the above equations are the same, except that $A_\textrm{time}$ becomes the extinction factor multiplied by the fraction of time spent in the gated-time detection window.
\FigBgBeamExtrapolate

The functions $f(p)$ and $g(t)$ represent the momentum and time projections of electrons after the beam blocker. 
Their factorisation in this manner is valid due to the lack of strong correlation visible in \fig{bg:beam:MomVsTime:stopTgt}.
It is reasonable to assume that, close to the signal region, the momentum distribution observed immediately after the beam blocker will have the same shape as the momentum distribution at the straw target.
Since the acceptance function is essentially flat at the high-energy limit (see \sect{optim:stopTgtPos} and \sect{sense:momentum}), only the normalisation of the spectrum should change, and this we have encapsulated already in the geometric acceptance.

Finally, the timing distribution, $g(t)$, is also taken by fitting the observed electron distribution after the beam blocker.
Here, however, one needs to be careful about extrapolating the distribution from after the beam blocker to the straw tracker.
The extrapolation can be imagined as two effects: an overall translation of the distribution to later times, and a broadening of the distribution (an increase in the fitted lifetime).
Both effects are determined by the time needed for particles at the beam blocker to propagate through the spectrometer.
With a radius of 2~m, the typical distance travelled along the beamline will be at least about 6~m, and since the electrons are relativistic and travelling at close to the speed of light, transport through the spectrometer can be expected to add about 20~ns.
This assumes particles follow the beam axis perfectly, so that their pitch angle is equal to zero.
With a large pitch angle the distance travelled, and therefore transportation time, will be longer, although since larger pitch angles drift more in the bent solenoids, these particles will tend to be removed more effectively.
The effect of broadening on the distribution arises from lower energy electrons moving more slowly, however for the relativistic signal-energy electrons this effect will be negligible.

\Fig{bg:beam:acceptance} show the momentum and time functions based on the distribution of electrons after the stopping target.
The equations for the lines of best fit are also shown, and the region used to fit indicated by the solid black fitted line.
The low-momentum threshold for this study, $p_\textrm{low}$, is set to 65~MeV/c, since this removes electrons from \ac{DIO} of muons along the beamline, which have relatively long life-times but cannot be produced at signal energies.
Above this threshold, there are 65 events at the straw tracker, giving a geometric acceptance of \VarBeamBgGeometric.
For the efficiency of the momentum cut, using the fit to the projection shown in \fig{bg:beam:acceptance:momentum}, the ratio of events expected between 104.2 and 105.5~MeV/c compared to the integrated rate from 65 to 105.5~MeV/c is \VarBeamBgMomentum.
For the timing efficiency, the fit given in \fig{bg:beam:acceptance:time} is first shifted so that the mean of timing distribution at the beam blocker sits at the time of the latest arriving electron above 65~MeV/c, as indicated
by the vertical magenta lines. 
This amounts to a shift of 110.5~ns, which is about twice as large as if one were to use the mean of the straw tracker electrons.
Having applied this shift (which we implement as a shift in the start and stop time for the integration), we find the suppression of electrons due to the time-gated window gives a factor \VarBeamBgTiming.

\TabBgBeamFactors
All of these factors are summarised in \tab{bg:beam:factors}.
Finally, then, we can pull all these factors together using \eq{bg:beam:factors}, from which we find that the predicted prompt beam-related background rate per POT is~\VarBeamBgPromptPerPOT, whilst the delayed background rate due to beam particles is \VarBeamBgDelayedPerPOT.

Given the extrapolation that has been necessary, this result comes with a large degree of uncertainty.
However, in principle this includes all sources of electrons in the beam: high-energy muons, pions, and electrons coming directly from the production target with high energy.
This also includes electrons produced from neutron capture, provided the neutron itself originated downstream of the production target section, which were not included here in order to accelerate the simulation speed.
In addition these neutrons should be studied carefully using multiple hadron production models but, as discussed in \sect{bg:notCovered}, these neutrons are left to future studies.

\section{Cosmic Ray Background}
\sectlabel{bg:cosmics}
\FigBgCosmicPrimary
Cosmic rays at sea level consist primarily of positive and negative muons, produced from high-energy particles originating in the sun or beyond the solar system strike the upper atmosphere and produce a particle shower.
About one muon per square cm per minute is expected at sea level, with the average muon energy around 4~GeV~\cite{PDG2014}.
At these energies, not only can they readily produce high-momentum electrons, but they are weakly ionising and therefore penetrate material relatively easily.

This makes cosmic muons a potential source of backgrounds, as the high-energy muons can pass through the experiment hall to the beamline where upon, if they decay, may produce signal-like electrons.
In addition, this background would lack any timing structure.
As a result, a  \ac{CRV} is included in both \phaseI and \phaseII made with four layers of scintillator bars as the active material.
When a cosmic ray passes this, events in the detector can either be tagged, or any trigger on this event vetoed and not read out, such that signal-like electrons produced from cosmic rays should not be included in the analysis.

At the time of writing, the \ac{CRV} has been optimised and studied for \phaseI~\cite{TDR2016,MeCM18Cosmics,DrutskoyCM20}.
These studies suggest that a miss-rate of less than 1 in $10^4$ events is achievable.
For \phaseII however, given the different experiment geometry, the situation is a little different.
If the muon penetrates into the detector and decays from there, or if a high-energy electron produced outside of the detector but close to it, is 
Principally, the stopping target in \phaseI is surrounded by the \ac{CDC}, such that cosmic muons must escape detection in both the \ac{CRV} and \ac{CDC}, and then decay close to the target.
In \phaseII, the stopping target is located well away from the detector, which means cosmic muons must only penetrate the \ac{CRV}.
Furthermore, the \ac{CRV} geometry in \phaseII should cover at least the target and intermediate beamline in addition to the detector solenoid itself.

\phaseII is expected to run about \VarRunTime~s as suggested in section~\sect{sense}.
During COMET operation, a single accelerator cycle is expected to last 2.48~s, with about 0.7~s for extraction, giving a duty factor of 0.28.
In addition, with a time-gated window lasting 600~ns and bunches separated by 1.170~$\mu$s, the overall duty factor drops to about 0.14.
As such, during \phaseII running there are really only about \num{2.9e6}~s when a cosmic muon can produce backgrounds.
During this time then, \num{4.8e4} cosmic muons should pass through each horizontal square centimetre of the COMET hall.
If we assume the miss-rate for the \phaseII will be no worse than for \phaseI, \ie \num{1e-4}, then for each for each square centimetre of the experiment, more than 48 muons should be studied.

\FigBgCosmicBeam
\FigBgCosmicMomenta
To simulate the cosmic ray background, input muon events were provided by the ND280 experiment~\cite{George:2010aca}.
These contained positive and negative muons that had been produced in an air shower simulation using the CORSIKA simulation package~\cite{Corsika}, for the atmosphere above J-PARC.
\Fig{bg:cosmics:primary} shows the distributions of momentum and directions that these files contained.

Muons were generated in a horizontal plane directly above the experiment hall (and centred on the origin of the ICEDUST coordinate system, the production target).
A 50$\times$50~m${}^2$ square within in this plane was used to generate the events.
This immediately adds a limitation to this simulation that very horizontally-moving muons cannot be studied, but it is needed to increase the simulation efficiency.
Given the angular distribution shown in \fig{bg:cosmics:primary} and the offset of the detector solenoid with respect to the production target, between XX and XX of all cosmic events can be simulated this way.
About \num{1.76e8} cosmic events were generated in this way; for the 2500~m${}^2$ region above the experiment where the simulation was started, more than \num{1.2e8} events should be studied, according to the above calculations.

Material above the beamline can degrade and stop cosmic muons so it is important this is modelled well.
The concrete and iron shielding for the entire experimental hall is implemented, as well as the shielding necessary for the \ac{CRV}.
However, at this stage the geometry in the simulation only has the CRV design intended for \phaseI around the detector solenoid (in its \phaseII position).
Since the CRV will need to be extended to include all the way up to the stoping target in \phaseII, there will likely be more shielding material inserted above the beamline.

\Fig{bg:cosmics:momenta} shows the momentum distribution of observed electrons.  
There are large fluctuations across the momentum distribution, but this is most likely due to statistical fluctuations rather than truely physical.
From 80 to 120 MeV/c, 140 electrons hit at least one layer in the straw tracker, although only 19 of these hit a second plane.
The number of background events due to cosmic rays can therefore be estimated as:
\begin{align}
	R_\textrm{cosmics}=R_\mu\frac{n_e^\textrm{obs}}{N_\textrm{sim}} \Delta{}p (1-\epsilon_\textrm{CRV}) A_\textrm{duty}A_\textrm{timing}A_\textrm{TDAQ,Recon}
\end{align}
where $R_\mu$ is the rate of cosmic muons expected through the experiment hall per second, $n_e^\textrm{obs}$ is the observed number of events per MeV/c, $N_\textrm{sim}$ is the number of simulated cosmic ray muons, and $\Delta{}M$ is the width of momentum thresholds, from \VarMomThreshold to 105.5~MeV/c.
$\epsilon_\textrm{CRV}$ is the \ac{CRV} efficiency, such that $(1-\epsilon_\textrm{CRV})$ is the expected miss-rate. 
The factors $A_\textrm{duty}$,$A_\textrm{timing}$, and $A_\textrm{TDAQ,Recon}$ represent the accelerator duty factor, fraction of time spent during the time-gated detection window, and the combined TDAQ and reconstruction effiency, respectively.  
The values for each of these parameters are given in \tab{bg:cosmics:params}.
From this we can estimate that there will be \VarCosmicRatePerSecond backgrounds per second due to cosmic rays.
\TabBgCosmicParameters

To reduce the cosmic ray background further, the most important parameter is the \ac{CRV} efficiency, the complement of which multiplies the entire background rate.
Since this background is completely uncorellated with the beam, the shorter the running time, the lower this background rate will be.
If this cannot be reduced further, then it might be necessary to add more material above the beamline or above the experiment hall.
Fortunately, rather than depend on simulation for this, \phaseII has the benefit of \phaseI, which will have measured and characterised the cosmic ray flux on the experiment hall floor.

%%Since all previous studies have only required a hit in one or more straw tracker planes for a track to be `accepted', in the interest of consistency we shall do the same here.
%The 19 events between 80 and 120 MeV/c coming from 176 million cosmic ray simulated events imply \VarCosmicRatePerMuPerMeV signal-like electrons per primary muon per MeV/c, or \VarCosmicRatePerMu within the momentum thresholds.
%As such, for the rate of cosmic rays passing through the 50$\times$50 m${}^2$ patch of sky above the hall, we can expect to be 
%With the signal momentum range of \VarMomThreshold to 105.5~MeV/c, and assuming 1 muon per minute per cm${}^2$, 
%
%Of these events, about XXX electrons with signal-like momenta were observed to hit a straw tracker plane, which are shown in the event display in \fig{bg:cosmic:eventDisplay}.
%No events were observed hitting more than one of the straw planes with the necessary momentum to be considered a background, and as such no events would have been reconstructed.
%Accordingly, we can only set a limit on the rate of backgrounds due to cosmic events coming from overhead muons.
%At 90\% C.L.\ the rate must be smaller than XXX to expect to see no background events in \num{1.7e8}

\section{Summary of Background Rates}
\sectlabel{bg:summary}
\TabBackgroundFinalVals
\Tab{bg:summary} gives an overview of the predicted rates.
The overal expected number of background events during \phaseII, assuming \VarRunTime~s of run time, is for \VarTotalBgPhasII events.
This is dominated by the cosmic ray background and events from antiprotons that stop in the target.
In light of the various uncertainties, discussed below further, we have tried to be as conservative as reasonably possible in this estimate; improving the uncertainties would hopefully reduce the estimated number of events.
It is clear, though, that further work must be undertaken on these predictions in the future.

\subsection{Backgrounds Not Considered}
\sectlabel{bg:notCovered}
\subsubsection*{Neutrons from the Production Target}
Although some of the methods above are different, compared to the \phaseI TDR and \phaseII CDR, there is only one source of backrounds that has not been included:
the production of high-energy electrons from the capture of neutrons that originate in the production target.
These neutrons were killed in order to reach a large number of muons and pions in the simulation, although neutrons produced along the muon beam (from the collimators, stopping target, \etc) have been included with the beam background.
Whilst there is a large amount of concrete and iron material in between the production target and the detector, the production target is likely a major source of neutrons in the experiment, and this needs to be studied rigorously using multiple hadron production and neutron transport codes.

Such studies have advanced for \phaseI, with the background rate from neutrons estimated to be about \num{3.1e-29}~per POT.
With a different experiment layout, production target material and higher proton beam power, separate studies should be performed  for \phaseII.
A naive scaling of this to the \phaseII number of protons on target would suggest that \num{2.7e-8} events can be expected in \phaseII.
Since the detector sits further away from the production target and since there is additional beamline then it is likely that the neutron rate is lower still.
The increased proton power would already be included in the naive scaling applied above to first order.
The different target material will change the neutron production cross section, but since the target is also made longer to maximize the muon stopping rate the increase in neutron yield might also be compensated for.

\subsubsection*{Detector Performance}
It has been implicitly assumed in the preceding work that the StrECAL is able to perfectly distinguish electrons from positrons, muons, and pions.
This seems a reasonable assumption, but it would be important to consider the rate of mis-identification in the event that these particles are able to be transported to the detector.
The long beamline and the electron spectrometer should remove these backgrounds, however.

In a similar vein, the impact of `pile-up events' should be considered.
Pile-up occurs when two separate particles enter or strike the same region of a detector within less time than the detector can resolve.
In the ECAL, pile-up could be an issue for triggering but since the ECAL's primary purpose in the analysis is to provide a time stamp, this should not be an issue for backgrounds.
Pile-up in the Straw Tracker should be easier to resolve because of the finer granularity of the detector, and the use of multiple hits on multiple straws to reconstruct the trajectory.

Instead, it is the occupancy of the straw tracker that should be considered.  
How often is a 105~MeV/c electron found due to the mistaken combination of hits in a high-occupancy event?
Machine learning techniques for \phaseI's \ac{CyDet} have been developed to significantly suppress hits from tracks other than signal electrons and it is likely that a similar approach will be possible in \phaseII.
In addition, although the beam power and production target material in \phaseII increase the multiplicity of particles in the beam, the longer beamline may well bring the occupancy down to lower levels than observed in \phaseI.

%Other sources of background might exist---putting a limit on all processes that produce fewer than a single electron from $10^{21}$~POT is no easy feat---and it 

\subsection{Principal Uncertainties}
Whilst it is not possible to make a quantitative estimate of the uncertainty at this time, it is clear that for some backgrounds the uncertainty is large.

\begin{description}
\item[Statistical Uncertainty and Use of Extrapolation]
In many instances the generated sample sizes for these background predictions were too small to directly evaluate the background rate.
In these cases it was necessary to extrapolate from parameters and regions with higher statistical power, such as lower energy parts of a spectrum, earlier in time, or use a more upstream part of the experiment.
In addition, it was often necessary to resample particles produced from an earlier stage of the simulation, such as for the muon and pion stopping distributions, or the beam fluxes leaving the production target region.
This introduces a different kind of error, which is very difficult to quantify, namely that there will now be some correlation between events seem downstream.

In the future, generating larger Monte Carlo samples using the continually increasing computing power available to the COMET experiment will be important in reducing this uncertainty.
In addition, cross checks using various different techniques to increase the statistical power of a limited set of simulated data will should also be explored.
The resampling and extrapolation used here is one approach, but methods such as particle weighting and biasing should also be explored.
In addition, separate studies could study the transmission of each section of the beamline separately, building a set of multi-dimensional (time, momentum, position, etc) transfer matrices.

\item[StrECAL Reconstruction and Resolution]
In the case of \ac{DIO} and \ac{RMC}, the two intrinsic sources of background, the main source of uncertainty is in the resolution function.
The exact the distribution for the residuals after reconstruction is not well known, especially for \phaseII.
In particular, for \ac{RMC}, the high-energy tail needs to be studied better. 
It has been assumed that fewer than 1 in \num{1e4} events will be reconstructed with momentum larger by 2.4~MeV/c or more than the true value.
This assumption must be confirmed, and if possible improved.
RMC on Al-26 was also discussed as a potential concern, however Al-26 has a tiny abundance in natural aluminium, whilst the rate of production in the COMET muon beam is difficult to predict.

\item[RPC Spectrum]
In the case of \acf{RPC}, the dominant uncertainty comes from the spectrum of photons produced during RPC.
The study here and in the \phaseI TDR depend entirely on a single set of experiments, which do not cover RPC from aluminium, only on magnesium and calcium
This will be difficult to improve further without additional observations, and it would be useful to study this at \phaseI if possible, perhaps by changing the Torus1's dipole field to improve pion acceptance.

\item[Antiproton Production]
Given the lack of experimental evidence for antiproton production in the `sub-threshold' regime and in the backwards direction, there is large uncertainty over the expected rate.
Whilst the model developed here was kept conservative, as one of the dominant backgrounds it is important to study this further.
A dedicated study comparing multiple different hadron production codes to all the possible experimental datasets (including forward and backward produced antiprotons from the different targets with different proton momentum) could reduce our uncertainty if now new experimental data is forthcoming.
Such a study would then be able to extrapolate better for the target material, proton energy and production direction used in COMET.

In addition to the production rates, there is reasonable uncertainty on the mechanisms by which antiprotons can produce background electrons.
Here it has been assumed that the primary mechanism is via pion production, but the rates for such production in aluminium is also not well known.
Such an assumption must also be confirmed.
%Direct emission of high-energy electrons is supposed to be relatively small~\cite{}, but it has not been rig

\item[Cosmic Ray Veto Geometry and Shielding]
Without a complete \ac{CRV} design, it is tough to be confident that the energy loss of cosmic muons is well captured in the \phaseII simulation.
In addition, the miss-rate of \num{1e-4} should be experimentally confirmed and ideally improved.
\end{description}

\section{Further Studies and Improvements}
\sectlabel{bg:improvements}
This chapter has presented an almost comprehensive set of estimates for background sources in \phaseII.
It should not, however, be treated as the final set of predictions, but rather as an initial set of studies that should be developed further.
In addition to the previoues suggestions regarding uncertainties in the present studies,
the following list gives a summary of possible methods that could be pursued to improve and expand the preceding set of estimates.

\begin{description}
	\item[Use different hadron production models] Primarily this is needed to cross check the muon and pion yields, and the production target optimisation.
		This is already well accommodated in ICEDUST, but should be exercised properly.
	\item[High-momentum electron acceptance vs. beamline position] Many background estimates would benefit from knowing the exact acceptance to high-momentum electrons at a given location in the beamline.
		This could be in the form of a multi-dimensional histogram or matrix, and would ideally also contain the acceptance's dependence on the electron direction, and transverse location.
		With this information, simulations for the cosmic ray backgrounds, photon conversion after RPC and RMC, and beam simulations would only need to know the probability of creating a high-momentum electron at a given location to deduce the resulting background rate.
\end{description}
%\begin{easylist}
%# Neutron background with different hadron codes and \alcap neutron spectrum from mu capture
%# Improved cosmic ray veto geometry
%# High-energy electron acceptance
%# Pion stops elsewhere in the beamline
%# StrECAL resolution function
%# Improved proton beam timing structure 
%# RMC from Al-26 that is produced from Al27 via neutrons. Photons can be made up to 108 MeV
%# Assumption that the PID abilities of the StrECAL are 100\%, is this true? At what level would muons be reconstructed at electrons?
%# RPC from pions stopping elsewhere in the beam -> Map of acceptance to RPC electrons vs. position of pion stop in the beamline
%\end{easylist}
